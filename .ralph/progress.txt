# Ralph Progress Log
Started: 2026-01-15

## Codebase Patterns
- (To be filled as patterns are discovered)

## Key Files
- (List key files relevant to this feature)

---

## 2026-01-15 - ralph-cli-b75
- Removed custom ralph-plan skill - beads now handles AI-managed task tracking
- Files changed:
  - Deleted `.claude/skills/ralph-plan/SKILL.md`
  - `source/components/SetupWizard.tsx` - Removed skill installation step
  - `source/utils/setup-scaffolding.ts` - Removed `installRalphPlanSkill` function and references
  - `source/utils/setup-checker.ts` - Removed skill path from `getRalphPaths` and check items
  - `source/templates/index.ts` - Removed `DEFAULT_RALPH_PLAN_SKILL` constant
  - `source/types/config.ts` - Removed `skillsDir` and `ralphPlanSkill` from `RalphPaths`
  - `source/app.tsx` - Updated "no-prd" view message to reference beads
  - `readme.md` - Updated documentation to reflect beads workflow
  - `.prettierignore` - Added `.beads`, `.claude`, `CLAUDE.md` to ignore formatting
- **Learnings:**
  - The ralph-plan skill was used for PRD-based planning (prd.json) - now replaced by beads
  - Multiple files referenced the skill: types, scaffolding, checker, templates, UI components
  - Pre-existing test infrastructure issues (eslint unicorn plugin, ava config) not related to changes
---

## 2026-01-15 - ralph-cli-w9o
- Fixed output stream visualization issue where tool calls broke TUI layout
- Root cause: Multi-line content in tool use/result strings (e.g., code snippets with newlines) was displayed without normalization
- Files changed:
  - `source/lib/stream-formatter.ts` - Added `normalizeWhitespace()` function and updated `truncate()` to normalize whitespace before display
- **Learnings:**
  - The `truncate()` function is used throughout the stream formatter for both tool inputs and outputs
  - TUI components like OutputPanel expect single-line strings per logical entry; embedded newlines break layout
  - The fix normalizes `\n`, `\r`, `\t` to spaces and collapses multiple consecutive spaces
  - Pre-existing test infrastructure issues prevent running ava tests, but manual testing via node confirms fix works
---

## 2026-01-15 - ralph-cli-3o9
- Created WelcomePanel.tsx and SetupWizardPanel.tsx for unified two-column UI
- Files created:
  - `source/components/WelcomePanel.tsx` - Welcome message for right panel when no ticket selected
  - `source/components/SetupWizardPanel.tsx` - Pure presentation component extracted from SetupWizard
- **Learnings:**
  - SetupWizard.tsx has display logic mixed with state/input handling - SetupWizardPanel extracts just the presentation
  - SetupStep type: 'checking' | 'prompt' | 'scaffolding' | 'complete' | 'error'
  - ScaffoldingStatus contains results for ralphDir, promptFile, progressFile, beads
  - Components use Box with borderStyle="round" and borderColor="gray" for panel styling
  - Type icons: ◎ epic, ★ feature, ⚠ bug, ◆ task (consistent across TicketSelector, MainLayout)
---

## 2026-01-15 - ralph-cli-68m
- Added `SetupPhase` type to state.ts for unified layout setup wizard states
- Deprecated `AppView` type with JSDoc `@deprecated` annotation
- Updated SetupWizardPanel.tsx to use `SetupPhase` instead of local `SetupStep` type
- Renamed prop from `step` to `phase` in SetupWizardPanel for consistency
- Files changed:
  - `source/types/state.ts` - Added SetupPhase type, deprecated AppView
  - `source/components/SetupWizardPanel.tsx` - Import SetupPhase from types, rename step→phase
- **Learnings:**
  - Types are exported through `source/types/index.ts` which re-exports all from state.js
  - SetupWizardPanel uses discriminated union pattern with conditional rendering based on phase
  - Pre-existing test infrastructure issues (eslint unicorn plugin) unrelated to this task
---

## 2026-01-15 - ralph-cli-82z
- Added embedded mode to TicketSelector for use in unified layout
- Updated MainLayout with leftContent/rightContent/headerContent props
- Exported WelcomePanel and SetupWizardPanel from components/index.ts
- Files changed:
  - `source/components/TicketSelector.tsx` - Added embedded prop (disables header/footer/keyboard), controlled selectedIndex, external tickets/loading/error props
  - `source/components/MainLayout.tsx` - Added leftContent, rightContent, headerContent props for conditional rendering; extracted default content into variables
  - `source/components/index.ts` - Exported SetupWizardPanel, ScaffoldingStatus type, WelcomePanel
- **Learnings:**
  - TicketSelector internal state: internalTickets, internalSelectedIndex, internalIsLoading, internalError
  - Embedded mode pattern: external props override internal state when embedded=true
  - useInput hook still fires in embedded mode, so we guard with `if (embedded) return`
  - MainLayout uses nullish coalescing (`??`) for content fallback to allow null/undefined custom content
  - Pre-existing eslint unicorn plugin bug blocks ava tests - build and prettier pass
---

## 2026-01-15 - ralph-cli-04u
- Added back navigation keyboard control ('b' key) to useKeyboardControls.ts
- Files changed:
  - `source/hooks/useKeyboardControls.ts` - Added onBackToTicketSelect callback, 'b' key handling, help text
- **Learnings:**
  - KeyboardCallbacks type extends with optional callbacks for new keybindings
  - KEYBOARD_HELP object provides help text for footer display
  - useInput callback pattern: check key condition, call callback with optional chaining, return to prevent other matches
---

## 2026-01-15 - ralph-cli-1yk
- Integrated unified layout in app.tsx - always renders MainLayout with calculated content
- Replaced `view` state (AppView) with `setupPhase` state (SetupPhase | null)
- Removed SetupWizard component usage - moved setup keyboard handling into app.tsx
- Added leftContent/rightContent/headerContent calculations based on state
- Added ticket selector state management in app.tsx for embedded mode
- Added handleBackToTicketSelect callback wired to useKeyboardControls
- Removed branch switching logic (deferred to ralph-cli-dm6)
- Files changed:
  - `source/app.tsx` - Major refactor: unified rendering via MainLayout
    - New state: setupPhase, setupCheckResult, scaffoldStatus, selectorTickets, selectorIndex, selectorLoading, selectorError
    - New computed: isMainView (setupPhase === null && has ticket selection)
    - Removed: view state, SetupWizard import, branch switching state/logic
    - Added useMemo for leftContent, rightContent, headerContent
    - Setup keyboard handling via useInput with isActive: setupPhase !== null
    - Ticket selector keyboard handling via useInput with isActive: isTicketSelectMode
- **Learnings:**
  - SetupPhase null indicates setup complete and in ticket selection or main view
  - isMainView logic: `setupPhase === null && (workMode === 'all' || selectedTicket !== null)`
  - isTicketSelectMode: `setupPhase === null && selectedTicket === null && workMode === 'specific'`
  - MainLayout accepts null for leftContent (hides left panel), undefined uses default
  - Keyboard handlers use {isActive: condition} to conditionally enable
  - Pre-existing eslint unicorn plugin bug blocks xo tests - build and prettier pass
---

## 2026-01-15 - ralph-cli-dm6
- Removed branch switching logic, added dismissable main-branch warning
- Files changed:
  - `source/utils/branch-utils.ts` - Removed: slugifyTitle, deriveBranchName, branchExists, getDefaultBranch, hasUncommittedChanges, createAndSwitchBranch. Added: isOnMainBranch()
  - `source/app.tsx` - Added main branch warning state, keyboard handler to dismiss ('d', Enter, Escape), warning banner UI
- **Learnings:**
  - branch-utils functions were defined but unused elsewhere after app.tsx branch logic was removed in ralph-cli-1yk
  - useInput hook with {isActive: showMainBranchWarning} enables conditional keyboard handlers
  - Warning banner uses Box with borderStyle="round" borderColor="yellow" for consistent styling
---

## 2026-01-15 - ralph-cli-edt
- Modified getAllOpenTickets() to include closed tickets in sidebar
- Changed from separate --status=open and --status=in_progress queries to single --all query
- Files changed:
  - `source/lib/beads-reader.ts` - getAllOpenTickets() now uses --all flag to include closed tickets
- **Learnings:**
  - getTicketChildren() already used --all flag so getTicketDescendants() already included closed
  - Only getAllOpenTickets() needed modification (used for 'all' work mode)
  - TicketList.tsx already had rendering support for closed status (green ✓ checkmark)
  - Using --all flag is cleaner than making multiple queries and combining results
---

## 2026-01-15 - ralph-cli-y1e
- Added third tab "Ticket" to TabPanel to view selected ticket during execution
- Tab key now cycles through: Output → Progress Log → Ticket → Output
- Files changed:
  - `source/components/TabPanel.tsx` - Added 'ticket' to TabId, imported TaskDetailPanel, added selectedTicket prop, renders TaskDetailPanel when ticket tab active
  - `source/hooks/useKeyboardControls.ts` - Updated tab cycling from toggle to 3-tab rotation using tabOrder array
  - `source/components/MainLayout.tsx` - Pass selectedTask to TabPanel as selectedTicket prop
- **Learnings:**
  - TabId type union used across TabPanel, useKeyboardControls, MainLayout - change in one requires updates to type
  - Tab cycling pattern: use array of tab IDs with modulo arithmetic for clean rotation
  - TaskDetailPanel already existed and renders BeadsIssue with description, status, blockers, blocks info
  - Empty state handling: show "Select a ticket" message when no ticket selected in Ticket tab
---
